<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Liuhz's Blog - Too often, people only believe what they want to believe.</title><meta name="author" content="Liu Hongzhen"><meta name="copyright" content="Liu Hongzhen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习 - 分享 - 收获">
<meta property="og:type" content="website">
<meta property="og:title" content="Liuhz&#39;s Blog">
<meta property="og:url" content="https://hongzhenliu.github.io/blog/index.html">
<meta property="og:site_name" content="Liuhz&#39;s Blog">
<meta property="og:description" content="学习 - 分享 - 收获">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yuntu.s3.ap-northeast-2.amazonaws.com/pics%2Flu%2F2022-07-24%2Fd44beb-avatar.jpg">
<meta property="article:author" content="Liu Hongzhen">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yuntu.s3.ap-northeast-2.amazonaws.com/pics%2Flu%2F2022-07-24%2Fd44beb-avatar.jpg"><link rel="shortcut icon" href="/blog/img/favicon.png"><link rel="canonical" href="https://hongzhenliu.github.io/blog/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: {"path":"/blog/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Liuhz\'s Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-07-28 21:38:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://yuntu.s3.ap-northeast-2.amazonaws.com/pics%2Flu%2F2022-07-24%2Fd44beb-avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/blog/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/blog/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://fastly.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/blog/">Liuhz's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Liuhz's Blog</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/hongzhenliu" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:mr.liuhz@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2022/07/24/hello-world/" title="Hello World"><img class="post_bg" src="https://images.pexels.com/photos/8107981/pexels-photo-8107981.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Hello World"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2022/07/24/hello-world/" title="Hello World">Hello World</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-07-24T06:02:20.657Z" title="发表于 2022-07-24 14:02:20">2022-07-24</time></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;

More info: Writing
Run server1$ hexo server

More info: Server
Generate static files1$ hexo generate

More info: Generating
Deploy to remote sites1$ hexo deploy

More info: Deployment
</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2021/02/24/java/0/" title="SpringBoot+Quartz"><img class="post_bg" src="https://images.pexels.com/photos/6940498/pexels-photo-6940498.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="SpringBoot+Quartz"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2021/02/24/java/0/" title="SpringBoot+Quartz">SpringBoot+Quartz</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-24T03:40:08.000Z" title="发表于 2021-02-24 11:40:08">2021-02-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/SpringBoot/">SpringBoot</a></span></div><div class="content">目标：实现定时任务的动态创建、启动、暂停、恢复、删除看了好多文章，都只讲了基础的demo用法，也就是简单的创建运行定时任务，对定时任务的管理却很少。
我这里从0开始搭建一个简单的demo，包括定时任务的各种操作，以及API的一些用法，可以实现大多场景的需求。如：

普通定时任务的创建、启动、停止。
动态创建定时任务，如创建一个订单，5分钟后执行某某操作。

整个 Quartz 的代码流程基本基本如下
首先需要创建我们的任务(Job)，比如取消订单、定时发送短信邮件之类的，这是我们的任务主体，也是写业务逻辑的地方。
创建任务调度器(Scheduler)，这是用来调度任务的,主要用于启动、停止、暂停、恢复等操作，也就是那几个api的用法。
创建任务明细(JobDetail)，最开始我们编写好任务(Job)后，只是写好业务代码，并没有触发，这里需要用JobDetail来和之前创建的任务(Job)关联起来，便于执行。
创建触发器(Trigger)，触发器是来定义任务的规则的，比如几点执行，几点结束，几分钟执行一次等等。这里触发器主要有两大类(SimpleTrigger和CronTrigger) ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2021/02/24/prometheus/0/" title="Spring Boot+Prometheus+Grafana"><img class="post_bg" src="https://images.pexels.com/photos/6940498/pexels-photo-6940498.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Spring Boot+Prometheus+Grafana"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2021/02/24/prometheus/0/" title="Spring Boot+Prometheus+Grafana">Spring Boot+Prometheus+Grafana</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-24T03:40:07.000Z" title="发表于 2021-02-24 11:40:07">2021-02-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/prometheus/">prometheus</a></span></div><div class="content">
Spring Boot 应用暴露监控指标【版本 1.5.7.RELEASE】首先，添加依赖如下依赖：
1234&lt;dependency&gt;	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;	&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt;

采集应用的指标信息，我们使用的是prometheus,相应的我们引入包:
12345&lt;dependency&gt;	&lt;groupId&gt;io.prometheus&lt;/groupId&gt;	&lt;artifactId&gt;simpleclient_spring_boot&lt;/artifactId&gt;	&lt;version&gt;0.0.26&lt;/version&gt;&lt;/dependency&gt;

然后，在启动类 Application.java 添加如下注解：
12345678@SpringBootAppli ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2021/02/01/kubenetes/17/" title="Kubernetes搭建高可用集群"><img class="post_bg" src="https://cdn.colorhub.me/LfSIpivn4Zo/rs:auto:0:500:0/g:sm/fn:colorhub/bG9jYWw6Ly8vYjMvNWQvOTRlMTU5ZjgwNzRkMTA1MDE2MzIxMjY3NmU1NmVjYmE5NmM1YjM1ZC5qcGVn.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Kubernetes搭建高可用集群"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2021/02/01/kubenetes/17/" title="Kubernetes搭建高可用集群">Kubernetes搭建高可用集群</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-01T01:48:17.000Z" title="发表于 2021-02-01 09:48:17">2021-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/kubenetes/">kubenetes</a></span></div><div class="content">Kubernetes搭建高可用集群前言之前我们搭建的集群，只有一个master节点，当master节点宕机的时候，通过node将无法继续访问，而master主要是管理作用，所以整个集群将无法提供服务

高可用集群下面我们就需要搭建一个多master节点的高可用集群，不会存在单点故障问题
但是在node 和 master节点之间，需要存在一个 LoadBalancer组件，作用如下：

负载
检查master节点的状态


对外有一个统一的VIP：虚拟ip来对外进行访问
高可用集群技术细节高可用集群技术细节如下所示：


keepalived：配置虚拟ip，检查节点的状态
haproxy：负载均衡服务【类似于nginx】
apiserver：
controller：
manager：
scheduler：

高可用集群步骤我们采用2个master节点，一个node节点来搭建高可用集群，下面给出了每个节点需要做的事情

初始化操作我们需要在这三个节点上进行操作
12345678910111213141516171819202122232425262728293031323334353637 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2021/02/01/kubenetes/16/" title="Kubernetes集群资源监控"><img class="post_bg" src="https://images.pexels.com/photos/8107912/pexels-photo-8107912.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Kubernetes集群资源监控"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2021/02/01/kubenetes/16/" title="Kubernetes集群资源监控">Kubernetes集群资源监控</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-01T01:48:16.000Z" title="发表于 2021-02-01 09:48:16">2021-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/kubenetes/">kubenetes</a></span></div><div class="content">Kubernetes集群资源监控概述监控指标一个好的系统，主要监控以下内容

集群监控
节点资源利用率
节点数
运行Pods


Pod监控
容器指标
应用程序【程序占用多少CPU、内存】



监控平台使用普罗米修斯【prometheus】 + Grafana 搭建监控平台

prometheus【定时搜索被监控服务的状态】

开源的
监控、报警、数据库
以HTTP协议周期性抓取被监控组件状态
不需要复杂的集成过程，使用http接口接入即可


Grafana

开源的数据分析和可视化工具
支持多种数据源




部署prometheus首先需要部署一个守护进程

1234567891011121314151617181920212223242526272829303132333435363738394041---apiVersion: apps/v1kind: DaemonSetmetadata:  name: node-exporter  namespace: kube-system  labels:    k8s-app: node-exporterspec:  selecto ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2021/02/01/kubenetes/15/" title="Kubernetes持久化存储"><img class="post_bg" src="https://images.pexels.com/photos/8107981/pexels-photo-8107981.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Kubernetes持久化存储"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2021/02/01/kubenetes/15/" title="Kubernetes持久化存储">Kubernetes持久化存储</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-01T01:48:15.000Z" title="发表于 2021-02-01 09:48:15">2021-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/kubenetes/">kubenetes</a></span></div><div class="content">Kubernetes持久化存储前言之前我们有提到数据卷：emptydir ，是本地存储，pod重启，数据就不存在了，需要对数据持久化存储
对于数据持久化存储【pod重启，数据还存在】，有两种方式

nfs：网络存储【通过一台服务器来存储】

步骤持久化服务器上操作
找一台新的服务器nfs服务端，安装nfs
设置挂载路径

使用命令安装nfs
1yum install -y nfs-utils

首先创建存放数据的目录
1mkdir -p /data/nfx

设置挂载路径
1234# 打开文件vim /etc/exports# 添加如下内容/data/nfs *(rw,no_root_squash)

执行完成后，即部署完我们的持久化服务器
Node节点上操作然后需要在k8s集群node节点上安装nfs，这里需要在 node1 和 node2节点上安装
1yum install -y nfs-utils

执行完成后，会自动帮我们挂载上
启动nfs服务端下面我们回到nfs服务端，启动我们的nfs服务
1systemctl start nfs


K8s集群部署应用最后我们在k8s集群上 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2021/02/01/kubenetes/14/" title="Kubernetes核心技术Helm"><img class="post_bg" src="https://cdn.colorhub.me/muBybzKvbLM/rs:auto:0:500:0/g:sm/fn:colorhub/bG9jYWw6Ly8vYTgvYWEvYjdmNmYwMTI1ZTE1MmQwN2M1OTM4NDA4N2Q5MjMxOTg3YWZmYThhYS5qcGVn.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Kubernetes核心技术Helm"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2021/02/01/kubenetes/14/" title="Kubernetes核心技术Helm">Kubernetes核心技术Helm</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-01T01:48:14.000Z" title="发表于 2021-02-01 09:48:14">2021-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/kubenetes/">kubenetes</a></span></div><div class="content">Kubernetes核心技术HelmHelm就是一个包管理工具【类似于npm】

为什么引入Helm首先在原来项目中都是基于yaml文件来进行部署发布的，而目前项目大部分微服务化或者模块化，会分成很多个组件来部署，每个组件可能对应一个deployment.yaml,一个service.yaml,一个Ingress.yaml还可能存在各种依赖关系，这样一个项目如果有5个组件，很可能就有15个不同的yaml文件，这些yaml分散存放，如果某天进行项目恢复的话，很难知道部署顺序，依赖关系等，而所有这些包括

基于yaml配置的集中存放
基于项目的打包
组件间的依赖

但是这种方式部署，会有什么问题呢？

如果使用之前部署单一应用，少数服务的应用，比较合适
但如果部署微服务项目，可能有几十个服务，每个服务都有一套yaml文件，需要维护大量的yaml文件，版本管理特别不方便

Helm的引入，就是为了解决这个问题

使用Helm可以把这些YAML文件作为整体管理
实现YAML文件高效复用
使用helm应用级别的版本管理

Helm介绍Helm是一个Kubernetes的包管理工具，就像Linux ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2021/02/01/kubenetes/13/" title="Kubernetes核心技术Ingress"><img class="post_bg" src="https://cdn.colorhub.me/muBybzKvbLM/rs:auto:0:500:0/g:sm/fn:colorhub/bG9jYWw6Ly8vYTgvYWEvYjdmNmYwMTI1ZTE1MmQwN2M1OTM4NDA4N2Q5MjMxOTg3YWZmYThhYS5qcGVn.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Kubernetes核心技术Ingress"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2021/02/01/kubenetes/13/" title="Kubernetes核心技术Ingress">Kubernetes核心技术Ingress</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-01T01:48:13.000Z" title="发表于 2021-02-01 09:48:13">2021-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/kubenetes/">kubenetes</a></span></div><div class="content">Kubernetes核心技术Ingress前言原来我们需要将端口号对外暴露，通过 ip + 端口号就可以进行访问
原来是使用Service中的NodePort来实现

在每个节点上都会启动端口
在访问的时候通过任何节点，通过ip + 端口号就能实现访问

但是NodePort还存在一些缺陷

因为端口不能重复，所以每个端口只能使用一次，一个端口对应一个应用
实际访问中都是用域名，根据不同域名跳转到不同端口服务中

Ingress和Pod关系pod 和 ingress 是通过service进行关联的，而ingress作为统一入口，由service关联一组pod中


首先service就是关联我们的pod
然后ingress作为入口，首先需要到service，然后发现一组pod
发现pod后，就可以做负载均衡等操作

Ingress工作流程在实际的访问中，我们都是需要维护很多域名， a.com  和  b.com
然后不同的域名对应的不同的Service，然后service管理不同的pod

需要注意，ingress不是内置的组件，需要我们单独的安装
使用Ingress步骤如下所示

部 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2021/02/01/kubenetes/12/" title="Kubernetes集群安全机制"><img class="post_bg" src="https://cdn.colorhub.me/HbjkrwGr78Q/rs:auto:0:500:0/g:sm/fn:colorhub/bG9jYWw6Ly8vNTIvNjQvOTU2ZTBmODFkM2VkZWM1NDA4YTA5NTZkMDI2MmM3ZmRmNDRjNTI2NC5qcGVn.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Kubernetes集群安全机制"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2021/02/01/kubenetes/12/" title="Kubernetes集群安全机制">Kubernetes集群安全机制</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-01T01:48:12.000Z" title="发表于 2021-02-01 09:48:12">2021-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/kubenetes/">kubenetes</a></span></div><div class="content">Kubernetes集群安全机制概述当我们访问K8S集群时，需要经过三个步骤完成具体操作

认证
鉴权【授权】
准入控制

进行访问的时候，都需要经过 apiserver， apiserver做统一协调，比如门卫

访问过程中，需要证书、token、或者用户名和密码
如果访问pod需要serviceAccount


认证对外不暴露8080端口，只能内部访问，对外使用的端口6443
客户端身份认证常用方式

https证书认证，基于ca证书
http token认证，通过token来识别用户
http基本认证，用户名 + 密码认证

鉴权基于RBAC进行鉴权操作
基于角色访问控制
准入控制就是准入控制器的列表，如果列表有请求内容就通过，没有的话 就拒绝
RBAC介绍基于角色的访问控制，为某个角色设置访问内容，然后用户分配该角色后，就拥有该角色的访问权限

k8s中有默认的几个角色

role：特定命名空间访问权限
ClusterRole：所有命名空间的访问权限

角色绑定

roleBinding：角色绑定到主体
ClusterRoleBinding：集群角色绑定到主体

主体

us ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/blog/2021/02/01/kubenetes/11/" title="Kubernetes配置管理"><img class="post_bg" src="https://cdn.colorhub.me/HbjkrwGr78Q/rs:auto:0:500:0/g:sm/fn:colorhub/bG9jYWw6Ly8vNTIvNjQvOTU2ZTBmODFkM2VkZWM1NDA4YTA5NTZkMDI2MmM3ZmRmNDRjNTI2NC5qcGVn.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Kubernetes配置管理"></a></div><div class="recent-post-info"><a class="article-title" href="/blog/2021/02/01/kubenetes/11/" title="Kubernetes配置管理">Kubernetes配置管理</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-01T01:48:11.000Z" title="发表于 2021-02-01 09:48:11">2021-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/kubenetes/">kubenetes</a></span></div><div class="content">Kubernetes配置管理SecretSecret的主要作用就是加密数据，然后存在etcd里面，让Pod容器以挂载Volume方式进行访问
场景：用户名 和 密码进行加密
一般场景的是对某个字符串进行base64编码 进行加密
1echo -n &#x27;admin&#x27; | base64


变量形式挂载到Pod
创建secret加密数据的yaml文件    secret.yaml


然后使用下面命令创建一个pod
1kubectl create -f secret.yaml

通过get命令查看
1kubectl get pods


然后我们通过下面的命令，进入到我们的容器内部
1kubectl exec -it mypod bash

然后我们就可以输出我们的值，这就是以变量的形式挂载到我们的容器中
1234# 输出用户echo $SECRET_USERNAME# 输出密码echo $SECRET_PASSWORD


最后如果我们要删除这个Pod，就可以使用这个命令
1kubectl delete -f secret-val.yaml

数据卷形式挂载首先我们创建 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/blog/page/2/#content-inner">2</a><a class="page-number" href="/blog/page/3/#content-inner">3</a><a class="extend next" rel="next" href="/blog/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://yuntu.s3.ap-northeast-2.amazonaws.com/pics%2Flu%2F2022-07-24%2Fd44beb-avatar.jpg" onerror="this.onerror=null;this.src='/blog/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Liu Hongzhen</div><div class="author-info__description">学习 - 分享 - 收获</div></div><div class="card-info-data site-data is-center"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/blog/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/blog/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hongzhenliu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/hongzhenliu" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:mr.liuhz@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/blog/2022/07/24/hello-world/" title="Hello World"><img src="https://images.pexels.com/photos/8107981/pexels-photo-8107981.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/blog/2022/07/24/hello-world/" title="Hello World">Hello World</a><time datetime="2022-07-24T06:02:20.657Z" title="发表于 2022-07-24 14:02:20">2022-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2021/02/24/java/0/" title="SpringBoot+Quartz"><img src="https://images.pexels.com/photos/6940498/pexels-photo-6940498.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="SpringBoot+Quartz"/></a><div class="content"><a class="title" href="/blog/2021/02/24/java/0/" title="SpringBoot+Quartz">SpringBoot+Quartz</a><time datetime="2021-02-24T03:40:08.000Z" title="发表于 2021-02-24 11:40:08">2021-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2021/02/24/prometheus/0/" title="Spring Boot+Prometheus+Grafana"><img src="https://images.pexels.com/photos/6940498/pexels-photo-6940498.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Spring Boot+Prometheus+Grafana"/></a><div class="content"><a class="title" href="/blog/2021/02/24/prometheus/0/" title="Spring Boot+Prometheus+Grafana">Spring Boot+Prometheus+Grafana</a><time datetime="2021-02-24T03:40:07.000Z" title="发表于 2021-02-24 11:40:07">2021-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2021/02/01/kubenetes/17/" title="Kubernetes搭建高可用集群"><img src="https://cdn.colorhub.me/LfSIpivn4Zo/rs:auto:0:500:0/g:sm/fn:colorhub/bG9jYWw6Ly8vYjMvNWQvOTRlMTU5ZjgwNzRkMTA1MDE2MzIxMjY3NmU1NmVjYmE5NmM1YjM1ZC5qcGVn.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Kubernetes搭建高可用集群"/></a><div class="content"><a class="title" href="/blog/2021/02/01/kubenetes/17/" title="Kubernetes搭建高可用集群">Kubernetes搭建高可用集群</a><time datetime="2021-02-01T01:48:17.000Z" title="发表于 2021-02-01 09:48:17">2021-02-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2021/02/01/kubenetes/16/" title="Kubernetes集群资源监控"><img src="https://images.pexels.com/photos/8107912/pexels-photo-8107912.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=1" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="Kubernetes集群资源监控"/></a><div class="content"><a class="title" href="/blog/2021/02/01/kubenetes/16/" title="Kubernetes集群资源监控">Kubernetes集群资源监控</a><time datetime="2021-02-01T01:48:16.000Z" title="发表于 2021-02-01 09:48:16">2021-02-01</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/blog/categories/SpringBoot/"><span class="card-category-list-name">SpringBoot</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/blog/categories/docker/"><span class="card-category-list-name">docker</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/blog/categories/kubenetes/"><span class="card-category-list-name">kubenetes</span><span class="card-category-list-count">15</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/blog/categories/minio/"><span class="card-category-list-name">minio</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/blog/categories/prometheus/"><span class="card-category-list-name">prometheus</span><span class="card-category-list-count">1</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/blog/tags/Quartz/" style="font-size: 1.1em; color: #999">Quartz</a> <a href="/blog/tags/SpringBoot/" style="font-size: 1.1em; color: #999">SpringBoot</a> <a href="/blog/tags/centos/" style="font-size: 1.1em; color: #999">centos</a> <a href="/blog/tags/docker/" style="font-size: 1.3em; color: #99a1ac">docker</a> <a href="/blog/tags/grafana/" style="font-size: 1.1em; color: #999">grafana</a> <a href="/blog/tags/k8s/" style="font-size: 1.5em; color: #99a9bf">k8s</a> <a href="/blog/tags/minio/" style="font-size: 1.1em; color: #999">minio</a> <a href="/blog/tags/prometheus/" style="font-size: 1.1em; color: #999">prometheus</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/blog/archives/2022/07/"><span class="card-archive-list-date">七月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/blog/archives/2021/02/"><span class="card-archive-list-date">二月 2021</span><span class="card-archive-list-count">17</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/blog/archives/2021/01/"><span class="card-archive-list-date">一月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/blog/archives/2020/05/"><span class="card-archive-list-date">五月 2020</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">21</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-07-28T13:38:11.168Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Liu Hongzhen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/blog/js/utils.js"></script><script src="/blog/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/blog/js/search/local-search.js"></script><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div><div class="aplayer no-destroy" data-id="1935777619" data-server="netease" data-type="song" data-fixed="true" data-autoplay="true" data-lrctype="0" > </div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>